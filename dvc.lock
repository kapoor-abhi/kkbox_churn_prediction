schema: '2.0'
stages:
  validate_data:
    cmd: python src/components/data_validation.py
    deps:
    - path: data/raw
      hash: md5
      md5: 3214f62dee8a9160aca9a24cf1468bbc.dir
      size: 2020416812
      nfiles: 4
    - path: src/components/data_validation.py
      hash: md5
      md5: c202e1d831e0a69418d452143278b42c
      size: 1175
      isexec: true
  data_ingestion:
    cmd: python src/components/data_ingestion.py
    deps:
    - path: config/config.yaml
      hash: md5
      md5: 3e0b00204dd785c36336b4b7a56a564b
      size: 264
      isexec: true
    - path: src/components/data_ingestion.py
      hash: md5
      md5: 0404fc95c7c4d1b5628f49b9de492672
      size: 2630
    outs:
    - path: data/processed
      hash: md5
      md5: 4a825fa1abf379780f2272fdecce9165.dir
      size: 1120755516
      nfiles: 30
  feature_engineering:
    cmd: python src/components/feature_engineering.py
    deps:
    - path: data/processed
      hash: md5
      md5: 4a825fa1abf379780f2272fdecce9165.dir
      size: 1120755516
      nfiles: 30
    - path: src/components/feature_engineering.py
      hash: md5
      md5: c94e98a814252a3cbf1ba885d92966bf
      size: 6263
      isexec: true
    outs:
    - path: data/featured/master_features.parquet
      hash: md5
      md5: 12a00fbae47c4373b6ced0efc424eccf
      size: 73242179
  model_training:
    cmd: MLFLOW_S3_ENDPOINT_URL=http://localhost:9000 PYTHONPATH=. python 
      src/components/model_training.py --config config/config.yaml --params 
      config/params.yaml
    deps:
    - path: data/featured/master_features.parquet
      hash: md5
      md5: 12a00fbae47c4373b6ced0efc424eccf
      size: 73242179
    - path: src/components/data_processor.py
      hash: md5
      md5: cae1089e5abb286a104ebebd602cb00b
      size: 5941
    - path: src/components/model_training.py
      hash: md5
      md5: 0ac3047323c980f5204e1bc583485a4d
      size: 5881
      isexec: true
    params:
      config/params.yaml:
        lgbm_params:
          objective: binary
          metric: auc
          n_estimators: 1000
          learning_rate: 0.05
          num_leaves: 31
          max_depth: -1
          min_child_samples: 20
          subsample: 0.8
          colsample_bytree: 0.8
          reg_alpha: 0.1
          reg_lambda: 0.1
          n_jobs: -1
          verbose: -1
        training:
          n_splits: 5
          random_state: 42
          target_col: is_churn
          unused_cols:
          - msno
          - is_churn
          - registration_init_time
    outs:
    - path: data/model/production_pipeline.pkl
      hash: md5
      md5: 26dfdb6c7d1cedb605f62cb6afe300ce
      size: 3468061
  drift_analysis:
    cmd: python src/components/drift_detection.py
    deps:
    - path: data/featured/master_features.parquet
      hash: md5
      md5: 1b2d11476c1f71bb6ead25ab54e32c2c
      size: 88914585
    - path: src/components/drift_detection.py
      hash: md5
      md5: 04cf8d63c6e7ff0506d421ec019dc8a0
      size: 2538
    outs:
    - path: data/drift_report_deepchecks.html
      hash: md5
      md5: 6799cb264820065bff164cffd66bdf90
      size: 7905228
    - path: data/integrity_report.html
      hash: md5
      md5: 9449572cbdc59db576becfd0132067c1
      size: 7790131
  data_validation:
    cmd: python src/components/data_validation.py
    deps:
    - path: data/featured/master_features.parquet
      hash: md5
      md5: 12a00fbae47c4373b6ced0efc424eccf
      size: 73242179
    - path: src/components/data_validation.py
      hash: md5
      md5: a3649660c7930bcd3b64d3e4912474cd
      size: 2572
      isexec: true
